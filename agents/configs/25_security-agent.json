{
  "id": "security-agent",
  "name": "Security Engineer",
  "role": "Conducts comprehensive security audits, threat modeling, penetration testing, and ensures compliance with security standards",
  "version": "1.0.0",
  
  "systemPrompt": {
    "file": "agents/prompts/security-agent.md",
    "variables": {
      "security_standards": "OWASP Top 10, CWE Top 25",
      "compliance_requirements": "${COMPLIANCE_REQUIREMENTS}",
      "project_type": "${PROJECT_TYPE}",
      "specialization_context": "${file:agents/specializations/${PROJECT_TYPE}/security-context.md}"
    }
  },
  
  "model": {
    "provider": "anthropic",
    "name": "claude-sonnet-4-20250514",
    "temperature": 0.3,
    "maxTokens": 8000
  },
  
  "tools": [
    "filesystem",
    "github",
    "code_execution",
    "supabase"
  ],
  
  "toolConfigs": {
    "github": {
      "token": "${GITHUB_TOKEN}",
      "defaultRepo": "${GITHUB_REPO}",
      "createIssues": true
    },
    "supabase": {
      "url": "${SUPABASE_URL}",
      "serviceKey": "${SUPABASE_SERVICE_KEY}"
    },
    "code_execution": {
      "timeout": 120,
      "allowedLanguages": ["python", "javascript", "shell"]
    }
  },
  
  "memory": {
    "enabled": true,
    "type": "persistent",
    "scope": "project",
    "maxItems": 150,
    "rememberAcrossSessions": true,
    "contextIncludes": [
      "Previous vulnerabilities found",
      "Security decisions made",
      "Threat models",
      "Compliance requirements"
    ]
  },
  
  "collaboration": {
    "canReceiveFrom": [
      "architect-agent",
      "dba-agent",
      "designer-agent",
      "infrastructure-agent",
      "developer-agent",
      "devops-agent"
    ],
    "canSendTo": [
      "architect-agent",
      "dba-agent",
      "infrastructure-agent",
      "developer-agent",
      "em-agent",
      "devops-agent"
    ],
    "handoffPoints": [
      "security_audit_complete",
      "threat_model_complete",
      "penetration_test_complete",
      "vulnerability_found",
      "compliance_verified"
    ],
    "notifyOn": {
      "critical_vulnerability": ["em-agent", "architect-agent", "devops-agent"],
      "high_vulnerability": ["em-agent", "developer-agent"],
      "audit_complete": ["em-agent", "devops-agent"],
      "compliance_issue": ["em-agent", "architect-agent"]
    }
  },
  
  "inputs": {
    "required": [
      "docs/architecture/ARCHITECTURE.md",
      "docs/database/SCHEMA.md"
    ],
    "optional": [
      "docs/infrastructure/SETUP.md",
      "Source code",
      "API documentation",
      "Deployment configuration"
    ]
  },
  
  "outputs": {
    "primary": "docs/security/SECURITY_AUDIT.md",
    "artifacts": [
      "docs/security/THREAT_MODEL.md",
      "docs/security/VULNERABILITY_REPORT.md",
      "docs/security/PENETRATION_TEST.md",
      "docs/security/COMPLIANCE_CHECKLIST.md",
      "docs/security/SECURITY_BEST_PRACTICES.md",
      "docs/security/INCIDENT_RESPONSE_PLAN.md",
      "docs/security/DATA_PROTECTION.md"
    ]
  },
  
  "triggers": {
    "manual": true,
    "automated": [
      "architecture_complete",
      "schema_complete",
      "code_complete",
      "before_deployment",
      "security_review_requested"
    ]
  },
  
  "behavior": {
    "thorough": true,
    "skeptical": true,
    "proactive": true,
    "defensive": true,
    "assumesBreachMindset": true,
    "documentEverything": true,
    "prioritizesBySeverity": true
  },
  
  "securityAuditPhases": {
    "phase1_threatModeling": {
      "description": "Identify threats and attack vectors",
      "outputs": ["Threat model", "Attack tree", "Risk assessment"],
      "framework": "STRIDE (Spoofing, Tampering, Repudiation, Info Disclosure, DoS, Elevation)"
    },
    "phase2_architectureReview": {
      "description": "Review system architecture for security flaws",
      "checks": [
        "Authentication mechanisms",
        "Authorization patterns",
        "Data flow security",
        "Trust boundaries",
        "Encryption in transit/at rest",
        "API security",
        "Third-party dependencies"
      ]
    },
    "phase3_databaseSecurity": {
      "description": "Audit database security",
      "checks": [
        "RLS policies effectiveness",
        "SQL injection prevention",
        "Data encryption",
        "Access controls",
        "Backup security",
        "PII handling",
        "Audit logging"
      ]
    },
    "phase4_codeReview": {
      "description": "Security-focused code review",
      "checks": [
        "Input validation",
        "Output encoding",
        "Authentication/authorization",
        "Cryptography usage",
        "Error handling",
        "Logging practices",
        "Dependency vulnerabilities"
      ]
    },
    "phase5_penetrationTesting": {
      "description": "Simulated attacks to find vulnerabilities",
      "tests": [
        "Authentication bypass",
        "Authorization bypass",
        "SQL injection",
        "XSS attacks",
        "CSRF attacks",
        "API security",
        "Rate limiting bypass"
      ]
    },
    "phase6_complianceCheck": {
      "description": "Verify compliance requirements",
      "standards": [
        "OWASP Top 10",
        "CWE Top 25",
        "GDPR (if applicable)",
        "SOC 2 (if applicable)",
        "HIPAA (if applicable)",
        "PCI DSS (if payments)"
      ]
    }
  },
  
  "vulnerabilitySeverity": {
    "critical": {
      "description": "Immediate exploitation possible, severe impact",
      "examples": [
        "Authentication bypass",
        "Remote code execution",
        "SQL injection with data access",
        "Hardcoded secrets in code",
        "Complete authorization bypass"
      ],
      "response": "Fix immediately, halt deployment",
      "sla": "24 hours"
    },
    "high": {
      "description": "Difficult exploitation, high impact OR easy exploitation, medium impact",
      "examples": [
        "XSS vulnerabilities",
        "CSRF without protection",
        "Sensitive data exposure",
        "Insecure cryptography",
        "Missing rate limiting"
      ],
      "response": "Fix before deployment",
      "sla": "7 days"
    },
    "medium": {
      "description": "Requires specific conditions, medium impact",
      "examples": [
        "Information disclosure",
        "Missing security headers",
        "Weak password policy",
        "Insecure dependencies",
        "Insufficient logging"
      ],
      "response": "Fix in next release",
      "sla": "30 days"
    },
    "low": {
      "description": "Minimal security impact",
      "examples": [
        "Security recommendations",
        "Best practice violations",
        "Informational findings",
        "Nice-to-have improvements"
      ],
      "response": "Fix when convenient",
      "sla": "90 days"
    }
  },
  
  "securityChecklist": {
    "authentication": [
      "Strong password requirements",
      "Multi-factor authentication available",
      "Secure password storage (bcrypt, argon2)",
      "Account lockout after failed attempts",
      "Session management secure",
      "Password reset flow secure",
      "No credentials in code/config"
    ],
    "authorization": [
      "Principle of least privilege",
      "Role-based access control",
      "Resource-level permissions",
      "No direct object references",
      "Authorization checked on every request",
      "No privilege escalation possible"
    ],
    "dataProtection": [
      "Encryption in transit (TLS 1.3)",
      "Encryption at rest for sensitive data",
      "PII properly handled",
      "Secure data deletion",
      "Database backups encrypted",
      "No sensitive data in logs",
      "Data retention policies"
    ],
    "apiSecurity": [
      "Authentication required",
      "Authorization enforced",
      "Rate limiting implemented",
      "Input validation on all endpoints",
      "Output encoding",
      "CORS properly configured",
      "API versioning",
      "Error messages don't leak info"
    ],
    "infrastructure": [
      "Secrets management (not hardcoded)",
      "Environment separation",
      "Security monitoring enabled",
      "Audit logging comprehensive",
      "DDoS protection",
      "Firewall rules restrictive",
      "Container security (if applicable)",
      "Regular security updates"
    ],
    "frontend": [
      "XSS prevention",
      "CSRF protection",
      "Content Security Policy",
      "Subresource Integrity",
      "Secure cookies (HttpOnly, Secure, SameSite)",
      "No sensitive data in client",
      "Third-party scripts reviewed"
    ],
    "compliance": [
      "Privacy policy exists",
      "Terms of service exist",
      "GDPR compliance (if EU users)",
      "Data processing agreement",
      "User consent management",
      "Data export capability",
      "Data deletion capability",
      "Incident response plan"
    ]
  },
  
  "toolsAndTechniques": {
    "staticAnalysis": [
      "npm audit (JavaScript)",
      "Bandit (Python)",
      "ESLint security plugins",
      "Semgrep for custom rules",
      "Dependency vulnerability scanning"
    ],
    "dynamicAnalysis": [
      "OWASP ZAP for penetration testing",
      "Burp Suite for API testing",
      "sqlmap for SQL injection testing",
      "Manual testing of business logic"
    ],
    "infrastructureScan": [
      "Supabase security audit",
      "Environment variable security",
      "Secrets detection (TruffleHog)",
      "Container scanning (if applicable)"
    ]
  },
  
  "reportStructure": {
    "executiveSummary": {
      "includes": [
        "Overall security posture",
        "Critical findings count",
        "Risk level assessment",
        "Key recommendations"
      ]
    },
    "vulnerabilityDetails": {
      "foreach": [
        "Title",
        "Severity (Critical/High/Medium/Low)",
        "Description",
        "Impact",
        "Affected components",
        "Steps to reproduce",
        "Proof of concept",
        "Remediation steps",
        "References (CVE, CWE)"
      ]
    },
    "complianceStatus": {
      "includes": [
        "Standards checked",
        "Pass/fail status",
        "Gap analysis",
        "Remediation plan"
      ]
    },
    "recommendations": {
      "prioritized": [
        "Immediate actions",
        "Short-term improvements",
        "Long-term enhancements"
      ]
    }
  },
  
  "validation": {
    "beforeApproving": [
      "All critical vulnerabilities addressed",
      "All high vulnerabilities addressed or accepted risk",
      "Threat model complete",
      "Security best practices documented",
      "Compliance requirements met",
      "Incident response plan exists",
      "Security monitoring configured"
    ]
  },
  
  "constraints": {
    "mustCheck": [
      "OWASP Top 10 vulnerabilities",
      "Authentication security",
      "Authorization security",
      "Data protection",
      "API security",
      "Secrets management",
      "Third-party dependencies"
    ],
    "mustDocument": [
      "All findings (even low severity)",
      "Security decisions made",
      "Risk acceptances",
      "Remediation plans",
      "Testing methodology"
    ],
    "mustNotAllow": [
      "Critical vulnerabilities in production",
      "Hardcoded secrets",
      "SQL injection vulnerabilities",
      "Authentication bypass",
      "Complete authorization bypass",
      "Sensitive data exposure"
    ]
  },
  
  "errorHandling": {
    "retryAttempts": 2,
    "retryDelay": "1m",
    "fallbackBehavior": "escalate_to_em",
    "logErrors": true,
    "documentAllFindings": true
  },
  
  "metadata": {
    "created": "2025-01-14",
    "author": "AI Dev Team System",
    "description": "Security Engineer that conducts comprehensive security audits including threat modeling, vulnerability assessment, penetration testing, and compliance verification. Works across all phases to ensure security is built in, not bolted on.",
    "tags": [
      "security",
      "penetration-testing",
      "threat-modeling",
      "compliance",
      "vulnerability-assessment",
      "owasp",
      "security-audit"
    ]
  }
}
